<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Tilt Test v5</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #1a1a1a; overflow: hidden; touch-action: none; font-family: monospace; }
#gameCanvas { display: block; background: #0a0a0a; }
#startBtn {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    padding: 20px 60px; font-size: 32px; background: #2196F3; color: white;
    border: none; border-radius: 12px; cursor: pointer; z-index: 10;
}
#info { position: absolute; top: 16px; left: 16px; font-size: 18px; color: white; z-index: 5; line-height: 1.6; }
#version { position: absolute; bottom: 16px; right: 16px; font-size: 14px; color: rgba(255,255,255,0.5); z-index: 5; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="info">
    Version 5 (Impulse Mode)<br>
    SnapX: <span id="tiltX">0</span><br>
    SnapY: <span id="tiltY">0</span><br>
    Status: <span id="status">Waiting for snap...</span>
</div>
<div id="version">v5.0</div>
<button id="startBtn">START</button>

<script>
const VERSION = 5;
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let gameRunning = false;
let dot = {
    x: 0, y: 0,
    vx: 0, vy: 0,
    radius: 20,
    friction: 0.92, // Higher friction so it stops quickly
    sensitivity: 1.5 // Multiplier for the "snap" force
};

function resetDot() {
    dot.x = canvas.width / 2;
    dot.y = canvas.height / 2;
    dot.vx = 0;
    dot.vy = 0;
}

function handleMotion(e) {
    // We use 'acceleration' which EXCLUDES gravity.
    // This captures only the user's manual movement.
    const acc = e.acceleration;
    if (!acc || acc.x === null) return;

    // We invert the axes so a physical move "Left" 
    // pushes the ball "Left" on the screen.
    let impulseX = -acc.x;
    let impulseY = acc.y;

    // Threshold: Ignore micro-jitters to keep ball stationary
    const threshold = 0.5;
    if (Math.abs(impulseX) > threshold) {
        dot.vx += impulseX * dot.sensitivity;
    }
    if (Math.abs(impulseY) > threshold) {
        dot.vy += impulseY * dot.sensitivity;
    }

    document.getElementById('tiltX').textContent = impulseX.toFixed(2);
    document.getElementById('tiltY').textContent = impulseY.toFixed(2);
}

function update() {
    if (!gameRunning) return;

    // Apply high friction to slow the ball down rapidly
    dot.vx *= dot.friction;
    dot.vy *= dot.friction;

    // Stop completely if moving very slowly
    if (Math.abs(dot.vx) < 0.1) dot.vx = 0;
    if (Math.abs(dot.vy) < 0.1) dot.vy = 0;

    dot.x += dot.vx;
    dot.y += dot.vy;

    // Bounds
    if (dot.x < dot.radius) { dot.x = dot.radius; dot.vx *= -0.3; }
    if (dot.x > canvas.width - dot.radius) { dot.x = canvas.width - dot.radius; dot.vx *= -0.3; }
    if (dot.y < dot.radius) { dot.y = dot.radius; dot.vy *= -0.3; }
    if (dot.y > canvas.height - dot.radius) { dot.y = canvas.height - dot.radius; dot.vy *= -0.3; }
}

function draw() {
    ctx.fillStyle = "#0a0a0a";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    if (!gameRunning) return;

    // Draw "Grip" Visual (Center point)
    ctx.strokeStyle = "rgba(33, 150, 243, 0.2)";
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, 40, 0, Math.PI*2);
    ctx.stroke();
    ctx.setLineDash([]);

    // Draw dot
    ctx.shadowColor = "#2196F3";
    ctx.shadowBlur = 15;
    ctx.fillStyle = "#2196F3";
    ctx.beginPath();
    ctx.arc(dot.x, dot.y, dot.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();

async function startGame() {
    if (typeof DeviceMotionEvent.requestPermission === 'function') {
        const response = await DeviceMotionEvent.requestPermission();
        if (response !== 'granted') return;
    }
    startBtn.style.display = "none";
    gameRunning = true;
    resetDot();
    window.addEventListener("devicemotion", handleMotion);
    document.getElementById('status').textContent = "Active - Snap the phone!";
}

startBtn.addEventListener("click", startGame);
</script>
</body>
</html>